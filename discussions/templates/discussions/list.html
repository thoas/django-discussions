{% extends "discussions/base.html" %}
{% load i18n discussions_tags %}
{% load url from future %}

{% block content_title %}<h2>{% trans "Messages" %}</h2>{% endblock %}

{% block content %}
    {% get_unread_message_count_for user as unread_message_count %}
    {% blocktrans %}{{ unread_message_count }} new messages.{% endblocktrans %}
    <a href="{% url "discussions_compose" %}">{% trans "Compose" %}</a>
    <ul>
        {% for discussion in discussion_list %}
            <li>
                <div class="recipient-list">
                    {% for recipient in discussion.recipients.all %}
                        <ul>
                            {% if recipient != user %}
                                <li><a href="{% url discussion_list user.username %}">{{ recipient }}</a></li>
                            {% endif %}
                        </ul>
                    {% endfor %}
                </div>

                <h2>{{ discussion.title }}</h2>

                {% if discussion.last_message %}
                    <p>{{ discussion.last_message.body }}</p>
                    <em>{% blocktrans with author=discussion.last_message.user %}By {{ author }}{% endblocktrans %}</em>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endblock %}
